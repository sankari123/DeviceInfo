<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
<title><center><font face=verdana size=12>Madras Music & Miscellany</font></center></title>
<script type="text/javascript" src="cordova.js"></script>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script type="text/javascript" src="html2canvas.js"></script>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="tableExport.js"></script>
<script type="text/javascript" src="jquery.base64.js"></script>
<script type="text/javascript" charset="utf-8" src="Canvas2ImagePlugin.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="canvas2image.js"></script>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/tableExport.js"></script>
<script type="text/javascript" src="js/jquery.base64.js"></script>

<script type="text/javascript" src="jspdf/libs/sprintf.js"></script>
<script type="text/javascript" src="jspdf/jspdf.js"></script>
<script type="text/javascript" src="jspdf/libs/base64.js"></script>

<!--<script language="JavaScript" type="text/javascript" src="events.js"></script>-->

<script type="text/JavaScript" language="JavaScript">
  var optSel;
	
function alertDismissed() {
            alert('ddd');
        }	
function init() {
    	document.addEventListener("deviceready", onDeviceReady, false);
	
}
function getLoc()
{
 	if (navigator.geolocation)
          {
            navigator.geolocation.getCurrentPosition(myMap);
          }
        else
          {
             alert("Geolocation API not supported.");
          }

}
function myMap(position) {
       x = position.coords.latitude;
        y = position.coords.longitude;
 }
function onDeviceReady(){
	window.plugins.spinnerDialog.show(null, "Loading Events... Please wait!");
	
	checkConnection();
	document.addEventListener("backbutton", function (e) {
        e.preventDefault(); 
	navigator.notification.confirm("Do you want to exit MMF?", onConfirmExit, "Madras Music & Miscellany", "Yes,No");    }, false );
}
function checkConnection() {
     var networkState = navigator.connection.type;
     if(navigator.connection.type == Connection.NONE) {        
        connSel='N';
	   //  alert(connSel);
	     
        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, RgotFS, fail);
    }
   else
      {
	    connSel='Y';
	     // alert(connSel);
	      ajaxFunction();
	 changedate('return');
	// ajaxFunction();
	 
      }
	
}
	
function RgotFS(fileSystem) {
        fileSystem.root.getFile("events.txt", null, RgotFileEntry, fail);
    }	
	
	
function gotFS(fileSystem) {
        fileSystem.root.getFile("events.txt", {create: true, exclusive: false}, gotFileEntry, fail);
}

function RgotFileEntry(fileEntry) {
        fileEntry.file(gotFile, fail);
    }
	
	
function gotFileEntry(fileEntry) {
        fileEntry.createWriter(WriteText, fail);
    }	

	
function gotFile(file){
      readDataUrl(file);
        readAsText(file);
    }


    function readDataUrl(file) {
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            console.log("Read as data URL");
            console.log(evt.target.result);
        };
        reader.readAsDataURL(file);
    }
	
	function readAsText(file) {
        var reader = new FileReader();
        reader.onloadend = function(evt) {
            console.log("Read as text");
            console.log(evt.target.result);
	 //   alert(evt.target.result);
	    document.getElementById('rest1').value=evt.target.result;	
	   changedate('return');
	//	 ajaxFunction();
        };
        reader.readAsText(file);
  }	
	
 function WriteText(writer) {
      writer.onwriteend = function(evt){ // Fired when end write.
        console.log("End write text in file");

    };
writer.write(ajaxResponse);
}
	
    function fail(error) {
        alert('Failed to load events...');
    }
	
	
function getDaysInMonth(m, y) {
    return m===2 ? y & 3 || !(y%25) && y & 15 ? 28 : 29 : 30 + (m+(m>>3)&1);
}	

	
	
	
function onConfirmExit(button) {
if(button==2){ //If User select a No, then return back;
       	return; }
else{
   if (navigator.app) {
     navigator.app.exitApp(); }
   else if (navigator.device) {
     navigator.device.exitApp(); } }	}
	   
	
	
	
/* Preload images script */
var myimages=new Array()
function preloadimages(){
	for (i=0;i<preloadimages.arguments.length;i++){
		myimages[i]=new Image();
		myimages[i].src=preloadimages.arguments[i];
	}
	
}
/* The path of images to be preloaded inside parenthesis: (Extend list as desired.) */
preloadimages("images/PrevYrOff40x40.png","images/PrevMoOff40x40.png","images/NextYrOff40x40.png","images/NextMoOff40x40.png");

var thisDate = 1;							// Tracks current date being written in calendar
var wordMonth = new Array("January","February","March","April","May","June","July","August","September","October","November","December");
var today = new Date();							// Date object to store the current date
var todaysDay = today.getDay() + 1;					// Stores the current day number 1-7
var todaysDate = today.getDate();					// Stores the current numeric date within the month
var todaysMonth = today.getUTCMonth() + 1;				// Stores the current month 1-12
var todaysYear = today.getFullYear();					// Stores the current year
var monthNum = todaysMonth;						// Tracks the current month being displayed
var yearNum = todaysYear;						// Tracks the current year being displayed
var firstDate = new Date(String(monthNum)+"/1/"+String(yearNum));	// Object Storing the first day of the current month
var firstDay = firstDate.getUTCDay();					// Tracks the day number 1-7 of the first day of the current month
var lastDate = new Date(String(monthNum+1)+"/0/"+String(yearNum));	// Tracks the last date of the current month
var numbDays = 0;
var calendarString = "";
var eastermonth = 0;
var easterday = 0;
var flg=1;
function changedate(buttonpressed) {
	ajaxFunction();
	//alert('optsel'+optSel);	
	if (buttonpressed == "prevyr") yearNum--;
	else if (buttonpressed == "nextyr") yearNum++;
	else if (buttonpressed == "prevmo") monthNum--;
	else if (buttonpressed == "nextmo") monthNum++;
	else  if (buttonpressed == "return") { 
		monthNum = todaysMonth;
		yearNum = todaysYear;
	}
	if (monthNum == 0) {
		monthNum = 12;
		yearNum--;
	}
	else if (monthNum == 13) {
		monthNum = 1;
		yearNum++
	}
	lastDate = new Date(String(monthNum+1)+"/0/"+String(yearNum));
	numbDays = lastDate.getDate();
	   
	if(isNaN(parseFloat("numbDays")))
	  {
	  numbDays = getDaysInMonth(monthNum, yearNum);
	  }
	  else
	  {
	   lastDate = new Date(String(monthNum+1)+"/0/"+String(yearNum));
	   numbDays = lastDate.getDate();
	  }
	  
	firstDate = new Date(String(monthNum)+"/1/"+String(yearNum));
	firstDay = firstDate.getDay() + 1;
	
	
	createCalendar();
	return;
	
	 	
	
	
	
}
function easter(year) {
// feed in the year it returns the month and day of Easter using two GLOBAL variables: eastermonth and easterday
var a = year % 19;
var b = Math.floor(year/100);
var c = year % 100;
var d = Math.floor(b/4);
var e = b % 4;
var f = Math.floor((b+8) / 25);
var g = Math.floor((b-f+1) / 3);
var h = (19*a + b - d - g + 15) % 30;
var i = Math.floor(c/4);
var j = c % 4;
var k = (32 + 2*e + 2*i - h - j) % 7;
var m = Math.floor((a + 11*h + 22*k) / 451);
var month = Math.floor((h + k - 7*m + 114) / 31);
var day = ((h + k - 7*m +114) % 31) + 1;
eastermonth = month;
easterday = day;
}
function createCalendar() {
	//window.plugins.spinnerDialog.hide();		
	calendarString = '';
	var daycounter = 0;
	calendarString += '<table width="312" border="1" cellpadding="0" cellspacing="1">';
	calendarString += '<tr>';
	calendarString += '<td align=\"center\" valign=\"center\" width=\"40\" height=\"40\"><a href=\"#\" onClick=\"changedate(\'prevyr\')\"><img name=\"PrevYr\" src=\"images\/PrevYrOff40x40\.png\" width=\"40\" height=\"40\" border=\"0\" alt=\"Prev Yr\"\/><\/a><\/td>';
	calendarString += '<td align=\"center\" valign=\"center\" width=\"40\" height=\"40\"><a href=\"#\" onClick=\"changedate(\'prevmo\')\"><img name=\"PrevMo\" src=\"images\/PrevMoOff40x40\.png\" width=\"40\" height=\"40\" border=\"0\" alt=\"Prev Mo\"\/><\/a><\/td>';
	calendarString += '<td bgcolor=\"#C8C896\" align=\"center\" valign=\"center\" width=\"128\" height=\"40\" colspan=\"3\"><b>' + wordMonth[monthNum-1] + '&nbsp;&nbsp;' + yearNum + '<\/b><\/td>';
	calendarString += '<td align=\"center\" valign=\"center\" width=\"40\" height=\"40\"><a href=\"#\" onClick=\"changedate(\'nextmo\')\"><img name=\"NextMo\" src=\"images\/NextMoOff40x40\.png\" width=\"40\" height=\"40\" border=\"0\" alt=\"Next Mo\"\/><\/a><\/td>';
	calendarString += '<td align=\"center\" valign=\"center\" width=\"40\" height=\"40\"><a href=\"#\" onClick=\"changedate(\'nextyr\')\"><img name=\"NextYr\" src=\"images\/NextYrOff40x40\.png\" width=\"40\" height=\"40\" border=\"0\" alt=\"Next Yr\"\/><\/a><\/td>';
	calendarString += '<\/tr>';
	calendarString += '<tr>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Sun<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Mon<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Tue<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Wed<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Thu<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Fri<\/td>';
	calendarString += '<td bgcolor=\"#DDDDDD\" align=\"center\" valign=\"center\" width=\"40\" height=\"22\">Sat<\/td>';
	calendarString += '<\/tr>';
	thisDate == 1;
	for (var i = 1; i <= 6; i++) {
		calendarString += '<tr>';
		for (var x = 1; x <= 7; x++) {
			daycounter = (thisDate - firstDay)+1;
			thisDate++;
			if ((daycounter > numbDays) || (daycounter < 1)) {
				calendarString += '<td align=\"center\" bgcolor=\"#888888\" height=\"30\" width=\"40\">&nbsp;<\/td>';
			} else {
				if (checkevents(daycounter,monthNum,yearNum,i,x) || ((todaysDay == x) && (todaysDate == daycounter) && (todaysMonth == monthNum))){
					if ((todaysDay == x) && (todaysDate == daycounter) && (todaysMonth == monthNum)) {
						calendarString += '<td align=\"center\" bgcolor=\"#81ab4b\" height=\"30\" width=\"40\"><a href=\"javascript:showevents(' + daycounter + ',' + monthNum + ',' + yearNum + ',' + i + ',' + x + ')\">' + daycounter + '<\/a><\/td>';
					}
 					else	calendarString += '<td align=\"center\" bgcolor=\"#FFFFC8\" height=\"30\" width=\"40\"><a href=\"javascript:showevents(' + daycounter + ',' + monthNum + ',' + yearNum + ',' + i + ',' + x + ')\">' + daycounter + '<\/a><\/td>';
				} else {
					calendarString += '<td align=\"center\" bgcolor=\"#ce9452\" height=\"30\" width=\"40\">' + daycounter + '<\/td>';
				}
			}
		}
		calendarString += '<\/tr>';
	}
	var object=document.getElementById('calendar');
	object.innerHTML= calendarString;
	thisDate = 1;
	
}
function checkevents(day,month,year,week,dayofweek) {
document.getElementById("rcorners3").innerText="";
document.getElementById("rcorners2").innerText="";
	document.getElementById("rcorners2").style.borderColor = "#FFFFFF";
	document.getElementById("rcorners3").style.borderColor = "#FFFFFF";
	document.getElementById("calEvent").style.display='block';
	document.getElementById("calEvent").style.visibility='true';
var numevents = 0;
var floater = 0;
	for (var i = 0; i < events.length; i++) {
		if (events[i][0] == "W") {
			if ((events[i][2] == dayofweek)) numevents++;
		}
		else if (events[i][0] == "Y") {
			if ((events[i][2] == day) && (events[i][1] == month)) numevents++;
		}
		else if (events[i][0] == "F") {
			if ((events[i][1] == 3) && (events[i][2] == 0) && (events[i][3] == 0) ) {
				easter(year);
				if (easterday == day && eastermonth == month) numevents++;
			} else {
				floater = floatingholiday(year,events[i][1],events[i][2],events[i][3]);
				if ((month == 5) && (events[i][1] == 5) && (events[i][2] == 4) && (events[i][3] == 2)) {
					if ((floater + 7 <= 31) && (day == floater + 7)) {
						numevents++;
					} else if ((floater + 7 > 31) && (day == floater)) numevents++;
				} else if ((events[i][1] == month) && (floater == day)) numevents++;
			}
		}
		else if ((events[i][2] == day) && (events[i][1] == month) && (events[i][3] == year)) {
			numevents++;
		}
	}
	if (numevents == 0) {
		return false;
	} else {
		return true;
	}
	
}
function showevents(day,month,year,week,dayofweek) {
	document.getElementById("det").style.display="block";
	document.getElementById("det").style.visibility="true";
	document.getElementById("rcorners3").innerText="";
	document.getElementById("rcorners2").innerText="";
	document.getElementById("rcorners2").style.borderColor = "#FFFFFF";
	document.getElementById("rcorners3").style.borderColor = "#FFFFFF";
	document.getElementById("calEvent").style.display='block';
	document.getElementById("calEvent").style.visibility='true';
var theevent = "";
var theeventNew = "";
var floater = 0;
	for (var i = 0; i < events.length; i++) {
		//alert(String(events[i][5]));
		
		
		// First we'll process recurring events (if any):
		if (events[i][0] != "") {
			if (events[i][0] == "D") {
			}
			if (events[i][0] == "W") {
				if ((events[i][2] == dayofweek)) {
				theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
				theevent += events[i][6] + '\n';
				theevent += 'Start Time: ' + events[i][4] + '\n';
				theevent += 'Ending Time: ' + events[i][5] + '\n';
				theevent += 'Description: ' + events[i][7] + '\n';
				theevent += '\n <HR>\n';
				document.forms.eventform.eventlist.value = theevent;
				}
			}
			if (events[i][0] == "M") {
			}
			if (events[i][0] == "Y") {
				if ((events[i][2] == day) && (events[i][1] == month)) {
				theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
				theevent += events[i][6] + '\n';
				theevent += 'Start Time: ' + events[i][4] + '\n';
				theevent += 'Ending Time: ' + events[i][5] + '\n';
				theevent += 'Description: ' + events[i][7] + '\n';
				theevent += 'Description: ' + events[i][8] + '\n';
				theevent += '\n -------------- \n\n';
				document.forms.eventform.eventlist.value = theevent;
				}
			}
			if (events[i][0] == "F") {
				if ((events[i][1] == 3) && (events[i][2] == 0) && (events[i][3] == 0) ) {
					if (easterday == day && eastermonth == month) {
						theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
						theevent += events[i][6] + '\n';
						theevent += 'Start Time: ' + events[i][4] + '\n';
						theevent += 'Ending Time: ' + events[i][5] + '\n';
						theevent += 'Description: ' + events[i][7] + '\n';
						theevent += 'Description: ' + events[i][8] + '\n';
						theevent += '\n -------------- \n\n';
						document.forms.eventform.eventlist.value = theevent;
					} 
				} else {
					floater = floatingholiday(year,events[i][1],events[i][2],events[i][3]);
					if ((month == 5) && (events[i][1] == 5) && (events[i][2] == 4) && (events[i][3] == 2)) {
						if ((floater + 7 <= 31) && (day == floater + 7)) {
							theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
							theevent += events[i][6] + '\n';
							theevent += 'Start Time: ' + events[i][4] + '\n';
							theevent += 'Ending Time: ' + events[i][5] + '\n';
							theevent += 'Description: ' + events[i][7] + '\n';
							theevent += 'Description: ' + events[i][8] + '\n';
							theevent += '\n -------------- \n\n';
							document.forms.eventform.eventlist.value = theevent;
						} else if ((floater + 7 > 31) && (day == floater)) {
							theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
							theevent += events[i][6] + '\n';
							theevent += 'Start Time: ' + events[i][4] + '\n';
							theevent += 'Ending Time: ' + events[i][5] + '\n';
							theevent += 'Description: ' + events[i][7] + '\n';
							theevent += 'Description: ' + events[i][8] + '\n';
							theevent += '\n -------------- \n\n';
							document.forms.eventform.eventlist.value = theevent;
						}
					} else if ((events[i][1] == month) && (floater == day)) {
						theevent += "Events of: \n" + month +'/'+ day +'/'+ year + '\n';
						theevent += events[i][6] + '\n';
						theevent += 'Start Time: ' + events[i][4] + '\n';
						theevent += 'Ending Time: ' + events[i][5] + '\n';
						theevent += 'Description: ' + events[i][7] + '\n';
						theevent += 'Description: ' + events[i][8] + '\n';
						theevent += '\n -------------- \n\n';
						document.forms.eventform.eventlist.value = theevent;
					}
				}
		}
		}
		// Now we'll process any One Time events happening on the matching month, day, year:
	//events.push(["",String(eMon),String(eDat),String(eYr),pTim,venue,pnam,Pdeta,art,pLatLong]);
		else if ((events[i][2] == day) && (events[i][1] == month) && (events[i][3] == year)) {
			//document.getElementById("div_hr").style.visibility="true";
			hours=String(events[i][4]);
			var timeString = hours;
			var H = +timeString.substr(0, 2);
			var h = H % 12 || 12;
			var ampm = H < 12 ? "AM" : "PM";
			timeString = h + timeString.substr(2, 3) + " "+ampm;
			var venue_1=String(events[i][5]);
		        venue_1=venue_1.replace('_',' ');
			 
			theevent += "Events of: " +day +'/'+ month + '/'+year + '\n';
			theevent += events[i][6] + '\n';
			theevent += 'Artist: ' + events[i][8] + '\n';
			theeventNew=  '       '+events[i][6] + '\n';
			theeventNew+= '     ' + events[i][8] + '\n';
			theevent += 'Time: ' +  timeString + '\n';
			theevent += 'Venue: ' + venue_1 + '\n';
			theevent += 'Details: ' + events[i][7] + '\n';
			theeventNew+='      '+events[i][7] ;
			theevent += '\n ____________________________________\n';
		//	document.forms.eventform.eventlist.value = theevent;
			//alert('event'+theevent);
			document.getElementById("rcorners2").style.borderColor = "#cfcece";
			//document.getElementById("rcorners2").innerText= day +'/'+ month + '/'+year +"   "+  timeString+"\n"+venue_1+'\n ____________________________________\n';
			document.getElementById("rcorners3").style.borderColor = "#cfcece";
		//	document.getElementById("rcorners3").innerText=theeventNew;


			//var evt_lst="div>cellspacing='0'>";
		//	evt_lst+="<tr ><td><img src='loc.png'>&nbsp;Location</td><td><img src='cal.png'>&nbsp;Date</td></tr>";
		//	evt_lst+="<tr height='70 px'><td>"+venue_1+"</td><td>"+day +'/'+ month + '/'+year +"   "+  timeString+"</td></tr>";
		//	evt_lst+="<tr bgcolor='#f3f3f3'><td colspan=2><b>Event Details<b></td></tr>"
		//	evt_lst+="<tr bgcolor='#f3f3f3'><td colspan=2>"+theeventNew+"</td></tr></table>";
 			
		 document.getElementById('left1').innerHTML="<img src='loc.png'>&nbsp;Location<br>"+venue_1;
		document.getElementById('right1').innerHTML="<img src='cal.png'>&nbsp;Date<br>"+day +"/"+ month + "/"+year +"   "+  timeString;
			document.getElementById('common1').innerHTML="Event Details<br>"+theeventNew;
//document.getElementById('calEvent').innerHTML=evt_lst ;
	

 }
			
			
			
			
			
		
	}
	if (theevent == "") 
	{
		//document.forms.eventform.eventlist.value = 'No events to show.';
	 	document.getElementById("rcorners2").style.borderColor = "#cfcece";
		document.getElementById("rcorners2").innerText='No events to show.';
		document.getElementById("rcorners3").innerText='';
	}
}
function floatingholiday(targetyr,targetmo,cardinaloccurrence,targetday) {
var firstdate = new Date(String(targetmo)+"/1/"+String(targetyr));	// Object Storing the first day of the current month.
var firstday = firstdate.getUTCDay();	// The first day (0-6) of the target month.
var dayofmonth = 0;	// zero out our calendar day variable.
	targetday = targetday - 1;
	if (targetday >= firstday) {
		cardinaloccurrence--;	// Subtract 1 from cardinal day.
		dayofmonth = (cardinaloccurrence * 7) + ((targetday - firstday)+1);
	} else {
		dayofmonth = (cardinaloccurrence * 7) + ((targetday - firstday)+1);
	}
return dayofmonth;
}
var ajaxResponse;
var arr_store;
function ajaxFunction()
{
	window.plugins.spinnerDialog.hide();
	if(connSel=='Y')
	{	
	var xhr = new XMLHttpRequest();
	xhr.open('GET', 'http://www.writeacademy.in/MMF/test.php', true);
	xhr.onload = function(){
    	//console.log(xhr);
		//alert(xhr.responseText);
	//document.getElementById("ajaxDiv").innerHTML = xhr.responseText;
	document.getElementById('rest1').value=xhr.responseText;
	ajaxResponse=xhr.responseText;
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
	procVal(ajaxResponse);
	};
	xhr.send();
	}
	else
	{
	//	alert('no conn');
	//	alert(document.getElementById('rest1').value);
	procVal(document.getElementById('rest1').value);
	}	
}
	function alertDismissed1()
	{
	navigator.device.exitApp();
		//navigator.app.exitApp();
	}
	
		
var latR;
var events = new Array();
var venue_arr = new Array();
function procVal(pVar)
{
//multiArr=[];
	//alert('Ajax Resp'+pVar);
	locArr = pVar;
	locArr = locArr.substring(0, locArr.length - 1);
	locArr=locArr.split('#');
	//alert('locarr'+locArr);
	events=[];
	venue_arr=[];
	for (var i = 0, len = locArr.length; i < len; i++) {
		delimiter = ',';
		start = 6;
		var result = locArr[i].split(delimiter, start+1).join(delimiter);
		latR=result.split(',');
		//multiArr.push([latR[0],latR[1],latR[2],latR[3],latR[4],latR[5]]);
		pnam=String(latR[0]);
		venue=String(latR[1]);
		venue=venue.replace(/\s/g, ' ');
		art=String(latR[2]);
		Pdeta=String(latR[3]);
		Pdeta=Pdeta.replace('^','\'');
		pTim=String(latR[5]);
		pLatLong=String(latR[6]);
		var dt = new Date(latR[4]);
		var eDat= dt.getDate();
		eMon=dt.getMonth()+1;
		eYr=dt.getFullYear();
		//multiArr.push([latR[2],latR[0],latR[1],dist]);
		events.push(["",String(eMon),String(eDat),String(eYr),pTim,venue,pnam,Pdeta,art,pLatLong]);
		venue_arr.push([venue]);
		//write ajax response to text file
		
		}
	
	//testing();
	uniq = remove_duplicates_safe(venue_arr);
//	uniq = uniq.map(function(e) {  var result = {};    result['text'] =e[0];  result['value'] =e[0];   return result;});
 //alert(events);
}
	

	
function remove_duplicates_safe(arr) {
    var seen = {};
    var ret_arr = [];
    for (var i = 0; i < arr.length; i++) {
        if (!(arr[i] in seen)) {
            ret_arr.push(arr[i]);
            seen[arr[i]] = true;
        }
    }
    return ret_arr;

}	
var flg=false;	
var lat2,long2;
// Show the picker
	

	
	function venueFilter()
	{
		var j;
		checkConnection();
		getLoc();
		for (var i = 0, len = uniq.length; i < len; i++) {
		//alert(uniq[i]);
		}
		//alert(uniq);
		//lst_mnu.innerHTML='';
		document.getElementById("lst_mnu").style.display="block";
		document.getElementById("lst_mnu").style.visibility="true";
		document.getElementById("calendar").style.display="none";
		document.getElementById("calendar").style.visibility="false";
		document.getElementById("category").style.display="none";
		document.getElementById("category").style.visibility="false";
		document.getElementById("det").style.display="none";
		document.getElementById("det").style.visibility="false";
		
		document.getElementById("xPort1").style.display="none";
		document.getElementById("xPort1").style.visibility="false";
		
		
		
		document.getElementById("xPort").style.display="none";
		document.getElementById("xPort").style.visibility="false";
		
		document.getElementById("dl_btn").style.display="none";
		document.getElementById("dl_btn").style.visibility="false";
		//alert('in');
		
        if(uniq.length % 2==0)
{
//alert('no add');
}
else
{
uniq.push(["d"]);
//alert('add');
}
		//var im_htm='';
var im_htm="<table border='0' class='ven' cellpadding='3' cellspacing='3'>";
	//for (var i = 0, len = multiArr.length-1; i < len; i++) {
	for (var i = 0, len = uniq.length; i < len; i++) {
	
	j=i+1;
		
		//checking
		//venue=String(latR[1]);
		//venue=venue.replace(/\s/g, ' ');
		//end check
		im_file=uniq[i]+".jpg";
		im1_file=uniq[j]+".jpg";
		// alert(uniq[i]);
	      //  alert(uniq[j]);	
		ch_uni=String(uniq[i]);
		 
		ch_uni=ch_uni.replace(/\s/g, '_');
		//venue.replace(/\s/g, ' ');
		//venue=venue.replace(/\s/g, ' ');
              ch_uni1=String(uniq[j]);
		ch_uni1=ch_uni1.replace(/\s/g, '_');

//  alert('after'+ch_uni);
//	alert('after'+ch_uni1);	
if(uniq[j]=='d')
{
	//	alert('in');
//	im_htm+="<font size=2><div class='left-div'><button onclick='ven_det(this.value);' style='display:none;' value="+ch_uni +">"+uniq[i]+"</button></div>";
	
im_htm+="<font size=2><tr height='80px' valign='top'><td width='50%' bordercolor='black'> <table border='1' bordercolor='black'   class='ven1' cellspacing='3' cellpadding='3'><tr height='80px'><td colspan='2' align='center'><button onclick='ven_det(this.value);' class='btn2' value="+ch_uni +">"+uniq[i]+"</button></td></tr></table></td></tr>";
 }
		else
		{
//		alert('out');
	//		im_htm+="<font size=2><div class='left-div'><button onclick='ven_det(this.value);' style='display:none;' value="+ch_uni +">"+uniq[i]+"</button></div>";
im_htm+="<font size=2><tr height='80px' valign='top'><td width='50%' bordercolor='black'> <table border='1' bordercolor='black' class='ven1' cellspacing='3' cellpadding='3'><tr height='80px'><td colspan='2' align='center'><button onclick='ven_det(this.value);' class='btn2' value="+ch_uni+">"+uniq[i]+"</button></td></tr></table></td>";	

			
//			im_htm+="<font size=2><div class='right-div'><button onclick='ven_det(this.value);' style='display:none;' value="+ch_uni1 +">"+uniq[j]+"</button></div>";	
			
im_htm+="<font size=2><td width='50%' bordercolor='black'> <table border='1' bordercolor='black' class='ven1' cellspacing='3' cellpadding='3'><tr height='80px'><td colspan='2' align='center'><button onclick='ven_det(this.value);' class='btn2' value="+ch_uni1+">"+uniq[j]+"</button></td></tr></table></td></tr>";
}
	 i=j;
	
	}
	
document.getElementById('lst_mnu').innerHTML=im_htm+"</font></table>" ;
	
	}
function calClick()
	{
		//alert('optsel'+optSel);
		optSel=2;
		//alert('optsel'+optSel);
		document.getElementById("calendar").style.display="block";
		document.getElementById("calendar").style.visibility="true";
		document.getElementById("category").style.display="none";
		document.getElementById("category").style.visibility="false";
		document.getElementById("xPort").style.display="none";
		document.getElementById("xPort").style.visibility="false";
		document.getElementById("xPort1").style.display="none";
		document.getElementById("xPort1").style.visibility="false";
		document.getElementById("lst_mnu").style.display="none";
		document.getElementById("lst_mnu").style.visibility="false";
		document.getElementById("dl_btn").style.display="none";
		document.getElementById("dl_btn").style.visibility="false";
		document.getElementById("route_canvas").style.display="none";
		document.getElementById("route_canvas").style.visibility="false"
		document.getElementById("panel").style.display="none";
		document.getElementById("panel").style.visibility="false";
	
		checkConnection();
	}

	function getDrive()
	{
	
	//alert('in');
	document.getElementById("route_canvas").style.display="block";
	document.getElementById("route_canvas").style.visibility="true";
	document.getElementById("panel").style.display="block";
	document.getElementById("panel").style.visibility="true";
	document.getElementById('panel').innerHTML = "";
	var directionsService = new google.maps.DirectionsService();
        var directionsDisplay = new google.maps.DirectionsRenderer();

         var map = new google.maps.Map(document.getElementById('route_canvas'), {
           zoom:7,
           mapTypeId: google.maps.MapTypeId.ROADMAP
         });
        
         directionsDisplay.setMap(map);
         directionsDisplay.setPanel(document.getElementById('panel'));
	//new google.maps.LatLng(position.coords.latitude,    position.coords.longitude), 13)
      	origin  = new google.maps.LatLng(x,y);
        destination = new google.maps.LatLng(lat2,long2);
         var request = {
		 
           origin: origin, 
           destination: destination,
           travelMode: google.maps.DirectionsTravelMode.DRIVING
         };
    
         directionsService.route(request, function(response, status) {
           if (status == google.maps.DirectionsStatus.OK) {
             directionsDisplay.setDirections(response);
           }
         });
	}
var table_string;
function ven_det(v)
{
	
	k=0;
	//venue=String(latR[1]);
	v=v.replace(/_/g, " ");
	
	document.getElementById("xPort").style.display="block";
	document.getElementById("xPort").style.visibility="true";
	document.getElementById("xPort1").style.display="block";
	document.getElementById("xPort1").style.visibility="true";
	
	document.getElementById("lst_mnu").style.display="none";
	document.getElementById("lst_mnu").style.visibility="false";
	document.getElementById("dl_btn").style.display="block";
	document.getElementById("dl_btn").style.visibility="true";
	
	
	
	
	var evt_lst="<table border='2' id='test' class='ven1' cellpadding='1' cellspacing='1'>";
	//events.push(["",String(eMon),String(eDat),String(eYr),pTim,venue,pnam,Pdeta,art,pLatLong]);	
	for (var i = 0, len = events.length; i < len; i++)
 {
	if(events[i][5]==v)
	{
		//alert('in');
		if(k==0)
		{
			//alert('in2');
			evt_lst+="<tr><td colspan=3 align='center'><b>"+v+"</b></td></tr><tr><td colspan=3 align='center'><b> Programme</b></td></tr>";
		}
		k++;
	   evt_lst+="<tr valign='top'><td bordercolor='black'> "+events[i][2]+"."+events[i][1]+"."+events[i][3]+"</td><td>"+events[i][4]+"</td><td>"+events[i][6]+"&nbsp;&nbsp;&nbsp;<b>"+events[i][8]+"</b>&nbsp;&nbsp;"+events[i][7]+"</td></tr>";
		
	}
	 table_string=evt_lst;
 document.getElementById('xPort').innerHTML=evt_lst+"</table>" ;
	

 }
//alert('venue '+v);
}
	  
	
	
function printData()
{
   var divToPrint=document.getElementById("xPort");

   pdf.htmlToPDF({
            data: divToPrint.innerHTML,
            documentSize: "A4",
            landscape: "portrait",
            type: "share" //use share to open the open-with-menu. 
        }, this.success, this.failure);
}

	
	$(document).ready(function(){
		$("#exportpdf").on('click', function () {
                 printData();
			});
			
});	

function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
	
	if(cityName=='London')
	{
	optSel=2;
	calClick();
	}
	else if(cityName=='Paris')
	{
	optSel=3;
	venueFilter();
	}
	else if(cityName=='Tokyo')
	{
	optSel=1;
	category();
	}
}	

	
	function category()
	{
	//alert('in');
	
			checkConnection();
		document.getElementById("category").style.display="block";
		document.getElementById("category").style.visibility="true";
		document.getElementById("calendar").style.display="none";
		document.getElementById("calendar").style.visibility="false";
		document.getElementById("lst_mnu").style.display="none";
		document.getElementById("lst_mnu").style.visibility="false";
		document.getElementById("xPort").style.display="none";
		document.getElementById("xPort").style.visibility="false";
		document.getElementById("xPort1").style.display="none";
		document.getElementById("xPort1").style.visibility="false";
	
		document.getElementById("dl_btn").style.display="none";
		document.getElementById("dl_btn").style.visibility="false";
		document.getElementById("rnd").style.display="none";
		document.getElementById("rnd").style.visibility="false";
		document.getElementById("det").style.display="block";
		document.getElementById("det").style.visibility="true";
		
		document.getElementById("route_canvas").style.display="none";
		document.getElementById("route_canvas").style.visibility="false"
		document.getElementById("panel").style.display="none";
		document.getElementById("panel").style.visibility="false";
		 
	
		 
		
	}
	document.getElementById("defaultOpen").click();


function eventList(eVal)
{
//alert('eval'+eVal);

document.getElementById("xPort").style.display="block";
document.getElementById("xPort").style.visibility="true";
	document.getElementById("xPort1").style.display="block";
	document.getElementById("xPort1").style.visibility="true";
	
document.getElementById("lst_mnu").style.display="none";
document.getElementById("lst_mnu").style.visibility="false";
document.getElementById("dl_btn").style.display="block";
document.getElementById("dl_btn").style.visibility="true";
document.getElementById("category").style.display="none";
document.getElementById("category").style.visibility="false";

var catSel;

if(eVal=='1' || eVal==1)
{
	catSel='Vocal';
}else if(eVal=='2' || eVal==2)
{
	catSel='Dance';
}else if(eVal=='3' || eVal==3)
{
	catSel='Drama';
}else if(eVal=='4' || eVal==4)
{
catSel='Lec-dem';
}else if(eVal=='5' || eVal==5)
{
catSel='Harikatha';
}else if(eVal=='6' || eVal==6)
{
catSel='Meetup';
	//alert(catSel.length);
}


var evt_lst="<table border='1' id='test' class='ven1' cellpadding='0' cellspacing='0'>";
evt_lst+="<tr height='40px'><td colspan=4 align='center'><b>"+  catSel +"   Schedule</b></td></tr>";
for (var i = 0, len = events.length; i < len; i++)
{
	cat1=events[i][6];
	if(catSel==cat1)
		{
			evt_lst+="<tr valign='top' height='25px'><td bordercolor='black'> "+events[i][2]+"."+events[i][1]+"."+events[i][3]+"</td><td>"+events[i][4]+"</td><td><span class='names'>"+events[i][5]+"</span></td><td>"+events[i][6]+"&nbsp;&nbsp;&nbsp;<b>"+events[i][8]+"</b>&nbsp;&nbsp;"+events[i][7]+"</td></tr>";
		}
 
} 
document.getElementById('xPort').innerHTML=evt_lst+"</table>" ;
}
	
	
	
	
	
</script>
	<style type="text/css">
		body, html {
    width: 100%; !important;
    height: 100vh;
    margin: 0;
    padding: 0;
    
}

.names { font-weight: bold; 
		text-align:left;}
		
		.ven
		{
	
			width: 100vw;
		  text-align:center; 	
			border-style: solid;
    border-color: black;
		}
		.ven1
		{
		 width: 100vw;
			  
			border-style: solid;
			font-size: 9pt;
    border-color: black;
	  border-collapse:separate;
    border:solid black 1px;
    border-radius:6px;
    -moz-border-radius:6px;
		}
	.ven2
		{
		 width: 100vw;
			  
			border-style: solid;
			font-size: 9pt;
    border-color: black;
	  border-collapse:separate;
    border:solid black 1px;
    border-radius:6px;
    -moz-border-radius:6px;
		}	
.hideDontTakeUpSpace
        {
            display:none;
        }

.btn1 {  background-color: transparent; border:none; padding: 0; font-weight: bold; color: white; text-decoration:underline;
    display:inline-block;}
		
		
.btn2 {  background-color: transparent; border:none; padding: 0; font-weight: bold; color: black;}
button:focus {outline:none;} ::-moz-focus-inner {border:0;}
#evtcal a:link {font: normal 12pt "Arial", "Helvetica", "Sans Serif"; color: #004400; text-decoration: none;}		/* unvisited link */
#evtcal a:visited {font: normal 12pt "Arial", "Helvetica", "Sans Serif"; color: #004400; text-decoration: none;}	/* visited link */
#evtcal a:hover {font: normal 12pt "Arial", "Helvetica", "Sans Serif"; color: #004400; text-decoration: underline;}	/* mouse over link */
#evtcal a:active {font: normal 12pt "Arial", "Helvetica", "Sans Serif"; color: #004400; text-decoration: none;}		/* selected link */
#lst_mnu
	{
		
		display:none;
		text-align:center;
		
    width: 100vw;
		
	}
#lst_mnu table {
    max-width: 400px;
    width: 100% !important;
  }
		
.cat
	{
  max-width: 400px;
    width: 100% !important;
}
	#evt_lst
	{
		display:none;
		height: 100vh;
		
	}
	.map_c
	{
		 width: 100vw;
	}
		
		
		 #middlecol {
    border-right: 2px solid red;
    width: 45%;
  }

  #middlecol table {
    max-width: 400px;
    width: 100% !important;
  }
		#xPort
	{
		
		max-width: 400px;
                width: 100% !important;
		display:none;
		 
		}
			#xPort1
	{
		
		display:none;
		 
		}
#dl_btn
	{
		
		display:none;	
		}

		
		div.tab {
    overflow: hidden;
    border: 0px solid #ccc;
    background-color:  #003c67;
    width: 100% !important;
    height:50px;
	    
	  
}
		
	.xPortFont
		{
			 font-size: 13px;
		}

/* Style the buttons inside the tab */
div.tab button {
    
   background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 13px;
    color: white;
    border-left:solid white 0px;
    border-right:solid white 0px;
    border-top:solid white 0px;
    border-bottom:solid #003c67 3px;
    background:#003c67;
    width:33%; height:50px
}

/* Change background color of buttons on hover */
div.tab button:hover {
    /*  background-color: #ddd;*/
    border-bottom:solid white 3px;
}

/* Create an active/current tablink class */
div.tab button.active {
     /*  background-color: #ccc;*/
     border-bottom:solid white 3px;
}

/* Style the tab content */
.tabcontent {
     display: none;
    padding: 3px 12px;
 /*   border: 1px solid #ccc;*/
    border-top: none;
}

/* Style the close button */
.topright {
    float: right;
    cursor: pointer;
    font-size: 20px;
}

.topright:hover {color: red;}

#div_hr
{
	display	: none;
		} 
		
.style1{
/*border-top: 1px solid #8c8b8b;*/
display	: none;
}
		
		#calEvent
		{
		
			width: 100vw;
			
			font-size: 9pt;
     

     display:none;
		
		}
		#rcorners2 {
  /*  border-radius: 25px;
    border: 2px solid #FFFFFF;
    padding: 20px; 
    width: 100vw; !important;*/
  
			
			width: 100vw;
			border-style: solid;
			font-size: 9pt;
    border-color: black;
	  border-collapse:separate;
    border:solid black 0px;
    border-radius:6px;
    -moz-border-radius:6px;
    height: 30px;
}
		#rcorners3 {
  /*  border-radius: 25px;
    border: 2px solid #FFFFFF;
    padding: 20px; 
    width: 100vw; !important;*/
			
			width: 100vw;
			border-style: solid;
			font-size: 9pt;
			min-height: 50px;
    border-color: black;
	  border-collapse:separate;
    border:solid black 0px;
    border-radius:6px;
    -moz-border-radius:6px;
   
}
	
		@media screen and (min-width: 100px) and (max-width: 199px)
{
    .button
    {
        width: 25px;
    }
}

@media screen and (min-width: 200px) and (max-width: 299px)
{
    .button
    {
        width: 50px;
    }
}
		
.left-div {
		 border-radius: 25px;
    float: left;
    width: 50vw;
    height: 20px;
    background-color: linen;
/*    margin-right: 8px;*/
  
}
.right-div {
 /*   margin-left: 108px;*/
	 width: 50vw;
	 border-radius: 25px;
	background-color: green;
    
}
.category
		{
		 
		border-radius: 25px;
    border: 2px solid #FFFFFF;
    padding: 20px; 
    width: 100vw; !important;
   
}
#calendar
		{
		 
		display	: none;
   
}		
span {
  display: inline-block;
  vertical-align: middle;
  margin-left: 60px;  /* width of image */
}
		
		
		.left1 {
        width:300px;
         
        float:left;
        height:40px;
    }
   .right1 {
       float:left;
       padding-left:100PX;
       
	   height:40px;
   }
   
   .common1 {
        width:100%;
         float:left;
         
   }
		
	</style>
	
</head>

<body style="background-color: transparent;" onload='init();'> 
<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tr height='70px' bgcolor="#ed7372"><td  align='center'><font face=arial><b>Madras Music & Miscellany</b></font></td></tr></table>
		
	 
<table border="0"  bordercolor='#003c67' cellpadding="0" cellspacing="0" width="100%">
	<tr height='25px'  bgcolor='#003c67'><td align=center>
	<div class="tab">
 
  <button class="tablinks" onclick="openCity(event, 'Tokyo')" id="defaultOpen">Events</button>
  <button class="tablinks" onclick="openCity(event, 'London')">Calendar</button>
  <button class="tablinks" onclick="openCity(event, 'Paris')">Venue</button>
		
</div>
		</td></tr></table>
<div id="London" class="tabcontent">
<!--  <span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
   
</div>

<div id="Paris" class="tabcontent">
<!--   <span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
  
</div>

<div id="Tokyo" class="tabcontent">
 <!--  <span onclick="this.parentElement.style.display='none'" class="topright">x</span>-->
 
</div>

	
	
	
	<div id='category' class='category'>
		<font size=1 face='arial'>Browse by Category</font><br><br>
	   <table border=0 cellpadding=0 cellpadding=0 class='cat'>
		   <tr><td><button onclick='eventList(1);' class='btn2'><img src='concert.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span>Concerts</span></button></td></tr>
		   <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		    <tr><td ><button onclick='eventList(2);' class='btn2' ><img src='dance.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span>Dance</span></button></td></tr>
		    <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		   <tr><td><button onclick='eventList(3);' class='btn2'><img src='drama.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span >Drama</span></button></td></tr>
		   <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		    <tr><td><button onclick='eventList(4);' class='btn2' ><img src='lec-dem.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span>Lec-Dem</span></button></td></tr>
		    <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		   <tr><td><button onclick='eventList(5);' class='btn2'><img src='harikatha.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span>Harikatha</span></button></td></tr>
		   <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		    <tr><td ><button onclick='eventList(6);' class='btn2' ><img src='concert.png'   style="vertical-align:middle"  bordercolor='FFFFFF'><span>Meetup</span></button></td></tr>
		    <tr valign="top"><td><hr size=1 color='#ececec'></td></tr>
		   
		</table>
			   
	</div>

	<table id="evtcal" border="0" cellpadding="0" cellspacing="0" width="100%"><tr>
			<td style="padding: 3px;" align="center" valign="top" width="314">
				<div id="calendar"><!--  Dynamically Filled --></div>
				
			</td></tr></table>
	<div id='lst_mnu' align='left'>	</div>
	<!--<div id="previewImage">
    </div>-->
      <div id='xPort' > <a id="dlink"  style="display:none;"></a>    </div>
	<div>
	
		 
		<p id="rcorners2" align='center'></p>
		<p id="rcorners3" align='center'></p>
	</div>
	<div id='calEvent'>
			 
		<div id='left1' class="left1"></div>
		<div id='right1' class="right1"></div>
		<div id='common1' class="common1"></div>
   
				
	</div>
	<div id='dl_btn'>
		<table border=0  cellpadding=0 cellspacing=0><tr><td width='33%'><button  class='btn1' onclick='calAdd();'><img src='cal1.png'></button></td><td width='33%'><button class='btn1' onclick='share();'><img src='share1.png'></button></td><td width='33%'> <button id="exportpdf" class='btn1' onclick='printData();'><img src='pdf.png'></button></td></tr></table>
	<!--	 <input type="button" id="exportpdf" value="Download PDF">-->
	<!--<a href="#" onClick ="$('#test').tableExport({type:'pdf',escape:'false'});">Download</a>-->
	</div>
	
			<div id='det' align='center' style="background-color:white">
				 
				<form id="eventform" name="eventform" action="#" method="get">
					<textarea name="eventlist"  style="border: none" cols="40" rows="20" wrap="soft" readonly>					</textarea>
				</form>
			</div>
	 
<textarea id="rest1" class="hideDontTakeUpSpace" rows=1 cols=50></textarea>
	
<div id='xPort1' style="display:none;">     </div>
	
</body>
</html>
